<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora de Asado Mejorada</title>
  <style>
    body { font-family: "Segoe UI", Arial; background:#f5f5f5; margin:0; padding:20px; }
    h1 { text-align:center; color:#b22222; }
    .card { background:#fff; padding:12px; margin:10px 0; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    input, select { padding:6px; margin:4px; border-radius:6px; border:1px solid #ccc; }
    button { padding:10px 15px; border:none; border-radius:6px; margin:5px; cursor:pointer; font-weight:bold; }
    .agregar { background:#2e8b57; color:#fff; }
    .calcular { background:#b22222; color:#fff; }
    .resultado { background:#fff; padding:15px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.15); margin-top:20px; }
    .item { padding:6px; border-bottom:1px solid #eee; }
    .debe { color:#b22222; font-weight:bold; }
    .recibe { color:#2e8b57; font-weight:bold; }
  </style>
</head>
<body>
<h1>üçñ Calculadora de Asado - Categor√≠as</h1>

<div id="personas"></div>
<button class="agregar" onclick="agregarPersona()">‚ûï Agregar persona</button>
<button class="calcular" onclick="calcular()">üìä Calcular</button>

<div id="resultado" class="resultado"></div>

<script>
let contador = 0;

function agregarPersona(){
  contador++;
  const div = document.createElement("div");
  div.className = "card";
  div.innerHTML = `
    <input id="nombre${contador}" placeholder="Nombre">
    Gast√≥: <input type="number" id="gasto${contador}" value="0" min="0">
    Categor√≠a:
    <select id="categoria${contador}">
      <option value="comida">üçñ Comida</option>
      <option value="bebida">üçª Bebida</option>
      <option value="extra">üßæ Extra</option>
    </select><br>
    Participaci√≥n:
    <label><input type="checkbox" id="come${contador}" checked> Come</label>
    <label><input type="checkbox" id="toma${contador}" checked> Toma</label>
  `;
  document.getElementById("personas").appendChild(div);
}

function calcular() {
  let personas = [];

  for(let i=1; i<=contador; i++){
    // si no existe el elemento, saltar (permite eliminar personas sin recargar)
    if(!document.getElementById("nombre"+i)) continue;
    personas.push({
      nombre: document.getElementById("nombre"+i).value || "Persona "+i,
      gasto: parseFloat(document.getElementById("gasto"+i).value) || 0,
      cat: document.getElementById("categoria"+i).value,
      come: document.getElementById("come"+i).checked,
      toma: document.getElementById("toma"+i).checked
    });
  }

  if(personas.length === 0){
    document.getElementById("resultado").innerHTML = "<p>No hay datos cargados.</p>";
    return;
  }

  let totalComida = personas.filter(p=>p.cat==="comida").reduce((s,p)=>s+p.gasto,0);
  let totalBebida = personas.filter(p=>p.cat==="bebida").reduce((s,p)=>s+p.gasto,0);
  let totalExtra  = personas.filter(p=>p.cat==="extra").reduce((s,p)=>s+p.gasto,0);

  let comen = personas.filter(p=>p.come).length;
  let toman = personas.filter(p=>p.toma).length;

  let costoComida = comen? totalComida/comen : 0;
  let costoBebida = toman? totalBebida/toman : 0;
  let costoExtra = personas.length? totalExtra/personas.length : 0;

  let resumen = `
    <h3>Resumen</h3>
    <p><b>Total comida:</b> $${totalComida.toFixed(2)} ‚Üí $${costoComida.toFixed(2)} por persona que comi√≥</p>
    <p><b>Total bebida:</b> $${totalBebida.toFixed(2)} ‚Üí $${costoBebida.toFixed(2)} por persona que tom√≥</p>
    <p><b>Total extra:</b> $${totalExtra.toFixed(2)} ‚Üí $${costoExtra.toFixed(2)} por cada uno</p>
  `;

  let detalle = "";
  let balances = {};

  personas.forEach(p=>{
    let debe = (p.come?costoComida:0) + (p.toma?costoBebida:0) + costoExtra;
    let balance = p.gasto - debe; // positivo = pag√≥ de m√°s (recibe), negativo = debe
    balances[p.nombre] = Math.round(balance*100)/100;
    let clase = balance<0 ? "debe" : balance>0 ? "recibe" : "";

    detalle += `<div class='item'><b>${p.nombre}</b>: <span class='${clase}'>${
      balance<0 ? "Debe $"+(-balance).toFixed(2) : balance>0 ? "Recibe $"+balance.toFixed(2) : "Justo"
    }</span></div>`;
  });

  document.getElementById("resultado").innerHTML = resumen + detalle;

  // Llamar a la funci√≥n que genera los pagos sugeridos
  if(typeof renderSettlements === 'function') renderSettlements(balances);
}

  // Settlements calculation
  function renderSettlements(balances) {
    const container = document.getElementById('settlements');
    container.innerHTML = '';
    const creditors = [];
    const debtors = [];
    for (const person in balances) {
      if (balances[person] > 0) creditors.push({ name: person, amount: balances[person] });
      else if (balances[person] < 0) debtors.push({ name: person, amount: -balances[person] });
    }
    creditors.sort((a, b) => b.amount - a.amount);
    debtors.sort((a, b) => b.amount - a.amount);
    let i = 0, j = 0;
    while (i < debtors.length && j < creditors.length) {
      const pay = Math.min(debtors[i].amount, creditors[j].amount);
      const p = document.createElement('div');
      p.textContent = `${debtors[i].name} debe pagar $${pay.toFixed(2)} a ${creditors[j].name}`;
      container.appendChild(p);
      debtors[i].amount -= pay;
      creditors[j].amount -= pay;
      if (debtors[i].amount === 0) i++;
      if (creditors[j].amount === 0) j++;
    }
    if (!container.innerHTML.trim()) container.textContent = 'Todos est√°n equilibrados, no hay deudas.';
  }
</script>
  <h2>Liquidaci√≥n entre personas</h2>
  <div id="settlements" class="mt-4 p-3 border rounded bg-gray-50 text-sm"></div>

</body>
</html>
